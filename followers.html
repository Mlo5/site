<!-- âš ï¸ Ø§Ù„ÙƒÙˆØ¯ ÙƒØ§Ù…Ù„ ÙƒÙ…Ø§ Ø·ÙÙ„Ø¨ â€“ Ù†ÙØ³ Ø§Ù„Ø³ØªØ§ÙŠÙ„ â€“ Ù†ÙØ³ Firebase -->
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<title>Ù…Ù†ØªØ¯Ù‰ Ø§Ù„Ù…ØªØ§Ø¨Ø¹ÙŠÙ† - MLO5</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600;800&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">

<style>
/* ========== Ù†ÙØ³ Ø³ØªØ§ÙŠÙ„ Ù…ÙˆÙ‚Ø¹Ùƒ (Ø¨Ø¯ÙˆÙ† ØªØºÙŠÙŠØ±) ========== */
:root{
--bg-dark:#020202;
--yellow:#facc15;
--white:#f9fafb;
--muted:#9ca3af;
--border-subtle:rgba(156,163,175,.35);
}
*{box-sizing:border-box;margin:0;padding:0}
body{
font-family:"Tajawal",sans-serif;
background:var(--bg-dark);
color:var(--white);
min-height:100vh;
}
.page{max-width:1100px;margin:auto;padding:20px}
.card{
background:#050505;
border:1px solid var(--border-subtle);
border-radius:18px;
padding:14px;
margin-bottom:16px;
}
h2{color:var(--yellow)}
textarea,input{
width:100%;
background:#000;
border:1px solid var(--yellow);
border-radius:14px;
color:#fff;
padding:12px;
}
.btn{
border:1px solid var(--yellow);
background:#000;
color:var(--yellow);
border-radius:999px;
padding:10px 16px;
cursor:pointer;
font-weight:900;
}
.post{
border:1px solid var(--border-subtle);
border-radius:18px;
padding:12px;
margin-bottom:14px;
background:#000;
}
.postHead{
display:flex;
justify-content:space-between;
align-items:center;
font-size:.9rem;
color:var(--muted);
}
.adminName{
color:#ef4444;
font-weight:900;
}
.actions{
display:flex;
gap:8px;
flex-wrap:wrap;
margin-top:8px;
}
.miniBtn{
border:1px solid var(--yellow);
background:#000;
color:var(--yellow);
border-radius:999px;
padding:6px 12px;
cursor:pointer;
}
.heart{color:#ef4444}
.pinned{border-color:#ef4444}
.pinIcon{color:#ef4444;font-weight:900}
.comment{
border:1px solid var(--border-subtle);
border-radius:14px;
padding:8px;
margin-top:8px;
}
.reply{
font-size:.85rem;
color:var(--muted);
margin-bottom:4px;
}
.ayah{
text-align:center;
color:var(--muted);
margin-top:10px;
font-size:.9rem;
}
</style>
</head>

<body>
<div class="page">

<!-- ========== Ø§Ù†Ø´Ø± Ø¨ÙˆØ³Øª (ÙÙˆÙ‚) ========== -->
<div class="card">
<h2>Ø§Ù†Ø´Ø± Ø¨ÙˆØ³Øª</h2>
<textarea id="postText" placeholder="Ø§ÙƒØªØ¨ Ù…Ù†Ø´ÙˆØ±Ùƒ..."></textarea><br><br>
<button class="btn" id="publishBtn">ğŸš€ Ù†Ø´Ø±</button>
<div class="ayah">ï´¿ Ù…ÙØ§ ÙŠÙÙ„Ù’ÙÙØ¸Ù Ù…ÙÙ†Ù’ Ù‚ÙÙˆÙ’Ù„Ù Ø¥ÙÙ„ÙÙ‘Ø§ Ù„ÙØ¯ÙÙŠÙ’Ù‡Ù Ø±ÙÙ‚ÙÙŠØ¨ÙŒ Ø¹ÙØªÙÙŠØ¯ÙŒ ï´¾</div>
</div>

<!-- ========== Ø§Ù„Ù…Ù†Ø´ÙˆØ±Ø§Øª ========== -->
<div id="posts"></div>

</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-auth.js";
import {
getFirestore, collection, addDoc, onSnapshot,
serverTimestamp, query, orderBy, updateDoc,
arrayUnion, arrayRemove, deleteDoc, doc
} from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyBnxruqFdBHEHTSVXl-QK848lsGvwBBH9U",
authDomain:"mlo5-users.firebaseapp.com",
projectId:"mlo5-users"
};

const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

let user=null;
const ADMIN_UID="VFjSs6kH2jcFJnddE7SXIpipzDi2";

onAuthStateChanged(auth,u=>{
user=u;
loadPosts();
});

const postsBox=document.getElementById("posts");

async function loadPosts(){
const q=query(
collection(db,"forumPosts"),
orderBy("pinned","desc"),
orderBy("createdAt","desc")
);

onSnapshot(q,snap=>{
postsBox.innerHTML="";
snap.forEach(d=>{
const p=d.data();
const isAdmin=user?.uid===ADMIN_UID;
const isOwner=user?.uid===p.uid;

const div=document.createElement("div");
div.className="post"+(p.pinned?" pinned":"");
div.innerHTML=`
<div class="postHead">
<div>
<span class="${isAdmin?"adminName":""}">${p.name}</span>
${p.pinned?'<span class="pinIcon"> ğŸ“Œ</span>':""}
</div>
<div>
${(isAdmin||isOwner)?'<button class="miniBtn del">ğŸ—‘ï¸</button>':""}
${isAdmin?'<button class="miniBtn pin">ğŸ“Œ</button>':""}
</div>
</div>
<div>${p.text}</div>

<div class="actions">
<button class="miniBtn heart">â¤ï¸ Ø§Ø­Ø¨Ø¨ØªÙ‡ (${(p.likes||[]).length})</button>
</div>

<div class="comments"></div>
`;
postsBox.appendChild(div);

/* Ø­Ø°Ù */
div.querySelector(".del")?.addEventListener("click",()=>{
if(confirm("Ø­Ø°Ù Ø§Ù„Ù…Ù†Ø´ÙˆØ±ØŸ"))
deleteDoc(doc(db,"forumPosts",d.id));
});

/* ØªØ«Ø¨ÙŠØª */
div.querySelector(".pin")?.addEventListener("click",()=>{
updateDoc(doc(db,"forumPosts",d.id),{pinned:!p.pinned});
});

/* Ù„Ø§ÙŠÙƒ */
div.querySelector(".heart").addEventListener("click",()=>{
const liked=(p.likes||[]).includes(user.uid);
updateDoc(doc(db,"forumPosts",d.id),{
likes: liked?arrayRemove(user.uid):arrayUnion(user.uid)
});
});
});
});
}

/* Ù†Ø´Ø± */
document.getElementById("publishBtn").onclick=async()=>{
const text=postText.value.trim();
if(!text)return;
await addDoc(collection(db,"forumPosts"),{
text,
uid:user.uid,
name:user.displayName||"User",
likes:[],
pinned:false,
createdAt:serverTimestamp()
});
postText.value="";
};
</script>
</body>
</html>
